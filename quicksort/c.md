## Implementation in C (generated by AI)

`partition.h`

```c
#ifndef PARTITION_H
#define PARTITION_H
void partition(char A[], int M, int N, int F, int *final_I, int *final_J);
#endif
```

`partition.c`

```c
#include "partition.h"

static void exchange(char *a, char *b) {
    char temp = *a;
    *a = *b;
    *b = temp;
}

void partition(char A[], int M, int N, int F, int *final_I, int *final_J) {
    char X = A[F];

    int I = M;
    int J = N;

up:
    for (; I <= N; I++) {
        if (X < A[I]) goto down;
    }
    I = N;

down:
    for (; J >= M; J--) {
        if (A[J] < X) goto change;
    }
    J = M;

change:
    if (I < J) {
       exchange(&A[I], &A[J]); 
       I = I + 1;
       J = J - 1;
       goto up;
    }
    else if (I < F) {
       exchange(&A[I], &A[F]); 
       I = I + 1;
    }
    else if (F < J) {
       exchange(&A[F], &A[J]); 
       J = J - 1;
    }
    *final_I = I;
    *final_J = J;
}
```
`partition-while.c`

```c
#include "partition.h"

static void exchange(char *a, char *b) {
    char temp = *a;
    *a = *b;
    *b = temp;
}

void partition(char A[], int M, int N, int F, int *final_I, int *final_J) {
    char X = A[F];
    int I = M;
    int J = N;

    while (1) {
        // Equivalent to 'up:' loop
        while (I <= N && A[I] <= X) {
            I++;
        }

        // Equivalent to 'down:' loop
        while (J >= M && A[J] >= X) {
            J--;
        }

        if (I < J) {
            // Equivalent to 'change:' swap and 'goto up'
            exchange(&A[I], &A[J]);
            I++;
            J--;
        } else {
            // Termination logic
            if (I < F) {
                exchange(&A[I], &A[F]);
                I++;
            } else if (F < J) {
                exchange(&A[F], &A[J]);
                J--;
            }
            break; // Exit the main loop
        }
    }

    *final_I = I;
    *final_J = J;
}

```

`quicksort.h`

```c
#ifndef QUICKSORT_H
#define QUICKSORT_H
void quicksort(char A[], int M, int N);
#endif
```

`quicksort.c`

```c
#include <stdlib.h>
#include "quicksort.h"
#include "partition.h"

void quicksort(char A[], int M, int N) {
    int I;
    int J;
    int F = M + rand() % (N - M + 1);
    if (M < N) {
        partition(A, M, N, F, &I, &J);
        quicksort(A, M, J); 
        quicksort(A, I, N); 
    }
}
```

`partition-test.c`

```
#include <stdio.h>
#include <string.h>
#include "partition.h"

void test(int f) {
    char str[] = "PARTITION";
    int m = 0;
    int n = strlen(str) - 1;
    int i = m;
    int j = n;
    printf("f=%d\nBefore:\t%s\n", f, str);
    partition(str, m, n, f, &i, &j);
    printf("After:\t%s\n", str);
}

int main() {
    char str[] = "PARTITION";
    for (int f = 0; f < strlen(str); f++) {
       test(f);
    }
    return 0;
} 
```

`quicksort-test.c`

```
#include <stdio.h>
#include <string.h>
#include "quicksort.h"

int main() {
    char str[] = "PARTITION";
    int n = strlen(str);
    int i = 0;
    int j = n-1;

    printf("%s\n", str);
    quicksort(str, i, j);
    printf("%s\n", str);
   
    return 0;
} 
```

`Makefile`

```make
test:	test-partition test-quicksort test-partition-while test-quicksort-while

partition.ll:	partition.c partition.h
	clang -S -emit-llvm partition.c

partition-while.ll:	partition-while.c partition.h
	clang -S -emit-llvm partition-while.c

quicksort.ll:
	clang -S -emit-llvm quicksort.c
	
test-partition: partition.ll
	clang -S -emit-llvm partition-test.c 
	clang partition-test.ll partition.ll
	./a.out
	rm a.out

test-partition-while: partition-while.ll
	clang -S -emit-llvm partition-test.c 
	clang partition-test.ll partition-while.ll
	./a.out
	rm a.out

test-quicksort: partition.ll quicksort.ll
	clang -S -emit-llvm quicksort-test.c
	clang quicksort-test.ll partition.ll quicksort.ll
	./a.out
	rm a.out

test-quicksort-while: partition-while.ll quicksort.ll
	clang -S -emit-llvm quicksort-test.c
	clang quicksort-test.ll partition-while.ll quicksort.ll
	./a.out
	rm a.out
```

`make test`

```sh
clang -S -emit-llvm partition.c
clang -S -emit-llvm partition-test.c 
clang partition-test.ll partition.ll
./a.out
f=0
Before:	PARTITION
After:	IANOIPTTR
f=1
Before:	PARTITION
After:	APRTITION
f=2
Before:	PARTITION
After:	PAINIORTT
f=3
Before:	PARTITION
After:	PARNITIOT
f=4
Before:	PARTITION
After:	AIRTPTION
f=5
Before:	PARTITION
After:	PARTINIOT
f=6
Before:	PARTITION
After:	AIRTITPON
f=7
Before:	PARTITION
After:	NAIIOTRTP
f=8
Before:	PARTITION
After:	IAINRTPOT
rm a.out
clang -S -emit-llvm quicksort.c
clang -S -emit-llvm quicksort-test.c
clang quicksort-test.ll partition.ll quicksort.ll
./a.out
PARTITION
AIINOPRTT
rm a.out
clang -S -emit-llvm partition-while.c
clang -S -emit-llvm partition-test.c 
clang partition-test.ll partition-while.ll
./a.out
f=0
Before:	PARTITION
After:	IANOIPTTR
f=1
Before:	PARTITION
After:	APRTITION
f=2
Before:	PARTITION
After:	PAINIORTT
f=3
Before:	PARTITION
After:	PARNITIOT
f=4
Before:	PARTITION
After:	AIRTPTION
f=5
Before:	PARTITION
After:	PARTINIOT
f=6
Before:	PARTITION
After:	AIRTITPON
f=7
Before:	PARTITION
After:	NAIIOTRTP
f=8
Before:	PARTITION
After:	IAINRTPOT
rm a.out
clang -S -emit-llvm quicksort-test.c
clang quicksort-test.ll partition-while.ll quicksort.ll
./a.out
PARTITION
AIINOPRTT
rm a.out
```
